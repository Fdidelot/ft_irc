# **************************************************************************** #
#                                                                              #
#                                                         :::      ::::::::    #
#    Makefile                                           :+:      :+:    :+:    #
#                                                     +:+ +:+         +:+      #
#    By: fdidelot <fdidelot@student.42.fr>          +#+  +:+       +#+         #
#                                                 +#+#+#+#+#+   +#+            #
#    Created: 2021/07/26 21:56:29 by fdidelot          #+#    #+#              #
#    Updated: 2022/01/31 18:59:16 by fdidelot         ###   ########.fr        #
#                                                                              #
# **************************************************************************** #

#-----------------------------------------------#
################# PROG_NAME #####################
#-----------------------------------------------#
NAME = ircserv

#-----------------------------------------------#
################## COMPILO ######################
#-----------------------------------------------#
CXX = clang++

#-----------------------------------------------#
################## SOURCES ######################
#-----------------------------------------------#
SRCS =		main.cpp							\
			Server.cpp

vpath %.cpp $(PATH_SRCS)

#-----------------------------------------------#
################## HEADERS ######################
#-----------------------------------------------#
HEADERS		=	Server.hpp						\

vpath %.hpp $(PATH_HEAD)

#-----------------------------------------------#
################## OBJECTS ######################
#-----------------------------------------------#
OBJS = $(addprefix $(PATH_OBJS), $(SRCS:.cpp=.o))

#-----------------------------------------------#
################### FLAGS #######################
#-----------------------------------------------#
CXXFLAGS =	-Wall -Wextra -Werror				\
			-std=c++98
ifeq ($(d), 0)
	CXXFLAGS	+= -Wpadded
	CXXFLAGS	+= -g3
	CXXFLAGS	+= -fsanitize=address,undefined
endif
ifeq ($(d), 1)
	CXXFLAGS	+= -g
endif

#-----------------------------------------------#
################# INCLUDES ######################
#-----------------------------------------------#
INCLUDES	=	-I $(PATH_HEAD)					\

#-----------------------------------------------#
################### PATHS #######################
#-----------------------------------------------#
# PATH_HEAD	=	./headers/
PATH_HEAD	=	./
PATH_SRCS	=	./sources/
PATH_OBJS	=	./objects/

#-----------------------------------------------#
################# LIBRARIES #####################
#-----------------------------------------------#
ifeq ($(d), 0)
	LDFLAGS		+= -fsanitize=address,undefined
endif

#-----------------------------------------------#
################### RULES #######################
#-----------------------------------------------#

all: $(NAME)

$(NAME): $(OBJS)
	$(CXX) -o $@ $^ $(LDFLAGS) $(LDLIBS) $(CXXFLAGS)

$(PATH_OBJS)%.o: $(PATH_SRCS)%.cpp
	$(CXX) -o $@ -c $< $(CXXFLAGS) $(INCLUDES)

$(OBJS): Makefile $(HEADERS) | $(PATH_OBJS)

$(PATH_OBJS):
	mkdir $@

clean:
	rm -rf $(PATH_OBJS)

fclean: clean
	rm -rf $(NAME)

re: fclean all

.PHONY: all clean fclean re
